# AstrBot Plugin Portrait (äººç‰©å½¢è±¡)

## ğŸ“¸ ç®€ä»‹

**astrbot_plugin_portrait** æ˜¯ä¸€æ¬¾ **AI ç»˜å›¾å¢å¼º + æ–‡ç”Ÿå›¾æœåŠ¡** æ’ä»¶ã€‚

å®ƒåœ¨æ£€æµ‹åˆ°ç”¨æˆ·æœ‰"ç”»å›¾"ã€"æ‹ç…§"æˆ–"æŸ¥çœ‹å½¢è±¡"çš„éœ€æ±‚æ—¶ï¼Œ**è‡ªåŠ¨æ³¨å…¥**ä¸€å¥—é¢„è®¾çš„é«˜è´¨é‡è§†è§‰æè¿°ç¬¦ï¼ˆVisual Descriptorsï¼‰ï¼Œå¹¶é€šè¿‡å†…ç½®çš„ **Gitee AI / Gemini AI** æ–‡ç”Ÿå›¾æœåŠ¡ç”Ÿæˆå›¾ç‰‡ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸ¨ **ä¸‰æä¾›å•†æ”¯æŒ**ï¼šGitee AI + Gemini AI + Grok AIï¼Œä¸»å¤‡è‡ªåŠ¨åˆ‡æ¢
- ğŸ¬ **è§†é¢‘ç”Ÿæˆ**ï¼šGrok AI å›¾ç”Ÿè§†é¢‘ï¼Œæ”¯æŒåŠ¨ä½œé¢„è®¾
- ğŸ–¼ï¸ **WebUI ç®¡ç†ç•Œé¢**ï¼šç¯å¢ƒåœºæ™¯/æ‘„å½±æ¨¡å¼å¯è§†åŒ–é…ç½®ï¼Œå›¾ç‰‡/è§†é¢‘ç”»å»Šç®¡ç†
- ğŸ“· **äººåƒå‚è€ƒåŠŸèƒ½**ï¼šä¸Šä¼ å‚è€ƒç…§ç‰‡ï¼ŒGemini ç”Ÿå›¾æ—¶è‡ªåŠ¨ä¿æŒè§’è‰²å½¢è±¡ä¸€è‡´
- ğŸ¤– **æ— ç¼é›†æˆ**ï¼šå¹³æ—¶éšèº«ï¼Œä»…åœ¨æ£€æµ‹åˆ°ç»˜å›¾æ„å›¾æ—¶ä»‹å…¥
- âš¡ï¸ **å¤šè½®æ³¨å…¥**ï¼šè§¦å‘åè¿ç»­å¤šè½®å¯¹è¯éƒ½ä¼šæºå¸¦ Visual Context
- ğŸ¯ **ç²¾å‡†æ§åˆ¶**ï¼šã€Œäººç‰©ã€ã€Œç¯å¢ƒã€ã€Œé•œå¤´ã€ä¸‰å¤§æ¨¡å—ç‹¬ç«‹é…ç½®

## ğŸ–¼ï¸ WebUI ç•Œé¢é¢„è§ˆ

### é…ç½®è®¾ç½®
![é…ç½®è®¾ç½®](https://raw.githubusercontent.com/i-kirito/astrbot_plugin_portrait/main/assets/webui_settings.png)

### äººåƒå‚è€ƒ
![äººåƒå‚è€ƒ](https://raw.githubusercontent.com/i-kirito/astrbot_plugin_portrait/main/assets/webui_selfie.png)

### å›¾ç‰‡ç”»å»Š
![å›¾ç‰‡ç”»å»Š](https://raw.githubusercontent.com/i-kirito/astrbot_plugin_portrait/main/assets/webui_gallery.png)

## ğŸ“¦ å®‰è£…

1. åœ¨ AstrBot ç®¡ç†åå° -> æ’ä»¶ç®¡ç† -> å®‰è£…æ’ä»¶
2. è¾“å…¥ä»“åº“åœ°å€ï¼š`https://github.com/i-kirito/astrbot_plugin_portrait`
3. å®‰è£…å®Œæˆåé‡å¯ AstrBot

## ğŸ® ä½¿ç”¨æ–¹å¼

### è‡ªç„¶è¯­è¨€è§¦å‘

æ— éœ€ç‰¹å®šæŒ‡ä»¤ï¼Œè‡ªç„¶è¯­è¨€å³å¯è§¦å‘ï¼š

- "å¸®æˆ‘ç”»ä¸€å¼ åœ¨å§å®¤çš„ç…§ç‰‡"
- "æ‹å¼ è‡ªæ‹ç»™æˆ‘çœ‹çœ‹"
- "çœ‹çœ‹ç°åœ¨åœ¨å¹²å˜›"ã€"çˆ†ç…§"ã€"ç»™æˆ‘åº·åº·"

### å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
| :--- | :--- |
| `/ç”»å›¾å¸®åŠ©` | æŸ¥çœ‹ç”»å›¾åŠŸèƒ½å¸®åŠ© |
| `/è§†é¢‘ <æç¤ºè¯>` | å›¾ç”Ÿè§†é¢‘ï¼ˆéœ€é™„å¸¦å›¾ç‰‡ï¼‰ |
| `/è§†é¢‘é¢„è®¾åˆ—è¡¨` | æŸ¥çœ‹å¯ç”¨çš„è§†é¢‘é¢„è®¾ |
| `/åå°ç®¡ç†` | æŸ¥çœ‹ WebUI çŠ¶æ€ |
| `/åå°ç®¡ç† å¼€` | æ‰‹åŠ¨å¯åŠ¨ WebUI |
| `/åå°ç®¡ç† å…³` | æ‰‹åŠ¨å…³é—­ WebUI |

## âš™ï¸ é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `char_identity` | äººç‰©èº«ä»½ç‰¹å¾æè¿° |
| `injection_rounds` | æ³¨å…¥è½®æ¬¡ï¼ˆé»˜è®¤ 1ï¼‰ |
| `enable_env_injection` | å¯ç”¨ç¯å¢ƒåœºæ™¯æ³¨å…¥ |
| `enable_camera_injection` | å¯ç”¨æ‘„å½±æ¨¡å¼æ³¨å…¥ |
| `draw_provider` | ä¸»å›¾ç‰‡ç”Ÿæˆæä¾›å•†ï¼ˆgitee/gemini/grokï¼‰ |
| `enable_fallback` | å¯ç”¨å¤‡ç”¨æä¾›å•†è‡ªåŠ¨åˆ‡æ¢ |
| `fallback_models` | å¤‡ç”¨æ¨¡å‹é¡ºåºï¼ˆé»˜è®¤ gemini, grokï¼‰ |
| `proxy` | HTTP ä»£ç†åœ°å€ |

### Gitee AI é…ç½® (gitee_config)

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `api_keys` | API å¯†é’¥æ± ï¼ˆæ”¯æŒå¤šä¸ªè½®è¯¢ï¼‰ |
| `base_url` | API åœ°å€ |
| `model` | æ¨¡å‹åç§°ï¼ˆz-image-turbo ç­‰ï¼‰ |
| `size` | è¾“å‡ºå°ºå¯¸ï¼ˆ1024x1024 ç­‰ï¼‰ |
| `num_inference_steps` | æ¨ç†æ­¥æ•° |
| `negative_prompt` | è´Ÿé¢æç¤ºè¯ |

### Gemini AI é…ç½® (gemini_config)

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `api_key` | API å¯†é’¥ |
| `base_url` | API åœ°å€ |
| `model` | æ¨¡å‹åç§° |
| `image_size` | åˆ†è¾¨ç‡ï¼ˆ1K/2K/4Kï¼‰ |

### Grok AI é…ç½® (grok_config)

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `api_key` | API å¯†é’¥ |
| `base_url` | API åœ°å€ï¼ˆé»˜è®¤ https://api.x.aiï¼‰ |
| `image_model` | å›¾ç‰‡æ¨¡å‹ï¼ˆé»˜è®¤ grok-imagine-1.0ï¼‰ |
| `video_model` | è§†é¢‘æ¨¡å‹ï¼ˆé»˜è®¤ grok-imagine-1.0-videoï¼‰ |
| `video_enabled` | å¯ç”¨è§†é¢‘ç”ŸæˆåŠŸèƒ½ |
| `video_presets` | è§†é¢‘é¢„è®¾è¯ï¼ˆæ ¼å¼ï¼šé¢„è®¾å:æç¤ºè¯ï¼‰ |
| `video_send_mode` | è§†é¢‘å‘é€æ¨¡å¼ï¼ˆauto/url/fileï¼‰ |
| `max_cached_videos` | æœ€å¤§ç¼“å­˜è§†é¢‘æ•°é‡ |

### äººåƒå‚è€ƒé…ç½® (selfie_config)

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `enabled` | å¯ç”¨äººåƒå‚è€ƒåŠŸèƒ½ |

> äººåƒå‚è€ƒå›¾ç‰‡è¯·åœ¨ WebUI ä¸­ä¸Šä¼ ç®¡ç†ï¼Œå­˜æ”¾äº `data/selfie_refs/` ç›®å½•

### WebUI é…ç½® (webui_config)

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `enabled` | å¯ç”¨ WebUI |
| `host` | ç›‘å¬åœ°å€ï¼ˆé»˜è®¤ 127.0.0.1ï¼‰ |
| `port` | ç«¯å£ï¼ˆé»˜è®¤ 8088ï¼‰ |
| `token` | è®¿é—®ä»¤ç‰Œï¼ˆå»ºè®®è®¾ç½®ï¼‰ |

### ç¼“å­˜é…ç½® (cache_config)

| é…ç½®é¡¹ | è¯´æ˜ |
| :--- | :--- |
| `max_storage_mb` | æœ€å¤§å­˜å‚¨ç©ºé—´ MBï¼ˆ0 ä¸é™åˆ¶ï¼‰ |
| `max_count` | æœ€å¤§å›¾ç‰‡æ•°é‡ï¼ˆ0 ä¸é™åˆ¶ï¼‰ |

## ğŸ”Œ æ’ä»¶é—´è°ƒç”¨ API

æœ¬æ’ä»¶æä¾›å…¬å…± APIï¼Œä¾›å…¶ä»– AstrBot æ’ä»¶è°ƒç”¨ç”Ÿå›¾èƒ½åŠ›ï¼š

```python
# åœ¨å…¶ä»–æ’ä»¶ä¸­è°ƒç”¨
for star in context.get_all_stars():
    if star.name == "astrbot_plugin_portrait":
        plugin = star.star_instance

        # æ–‡ç”Ÿå›¾
        result = await plugin.generate_image_api(
            prompt="a cute cat",
            provider="gemini",  # å¯é€‰ï¼šgitee/gemini/grok
            size="1K",          # å¯é€‰ï¼š1K/2K/4K æˆ– 1024x1024
        )
        if result:
            mime, b64 = result
            # ä½¿ç”¨ base64 å›¾ç‰‡...

        # æ”¹å›¾
        result = await plugin.edit_image_api(
            prompt="change background to blue",
            image_bytes=original_image_bytes,
            provider="gemini",
        )
```

## ğŸ› ï¸ ç‰ˆæœ¬å†å²

### v3.4.0 (2026-02-08)
- å…¬å…± APIï¼šgenerate_image_api / edit_image_api ä¾›å…¶ä»–æ’ä»¶è°ƒç”¨

### v3.3.0 (2026-02-08)
- ç‹¬ç«‹æ”¹å›¾æä¾›å•†ï¼ŒåŠ¨æ€æ¨¡å‹åˆ‡æ¢
- å‰åç«¯æ€§èƒ½ä¼˜åŒ–ï¼Œç½‘ç»œè¿æ¥æ± ä¼˜åŒ–
- API Key æ©ç åŒ–ï¼ŒToken æ—¶åºå®‰å…¨

### v3.2.0 (2026-02-07)
- è§†é¢‘é¢„è®¾è¯ç®¡ç†é¡µé¢ï¼Œç”»å»Šåˆ—æ•°å¯è°ƒ
- å¤‡ç”¨æ¨¡å‹é¡ºåºå¯é…ç½®
- åç«¯ O(n) å»é‡ä¼˜åŒ–

### v3.1.0 (2026-02-06)
- è§†é¢‘ç”»å»Šé¡µé¢ï¼Œç¼“å­˜æ¸…ç†åŠŸèƒ½
- WebUI é…ç½®å®Œæ•´åŒæ­¥

### v3.0.0 (2026-02-05)
- Grok AI å›¾ç”Ÿè§†é¢‘ï¼Œè§†é¢‘é¢„è®¾ç³»ç»Ÿ

### v2.9.x (2026-02-05)
- æ™ºèƒ½å‚è€ƒå›¾åŠ è½½ï¼Œä¿®å¤æ— é™å¾ªç¯ç”Ÿå›¾

### v2.8.x (2026-02-04)
- SSRF é˜²æŠ¤å¢å¼ºï¼ŒWebUI å®‰å…¨åŠ å›º

### v2.7.0 (2026-02-04)
- `/åå°ç®¡ç†` å‘½ä»¤ï¼Œä¿®å¤æœªæˆæƒè®¿é—®

### v2.6.0 (2026-02-03)
- äººåƒå‚è€ƒåŠŸèƒ½ï¼ŒWebUI äººåƒç®¡ç†é¡µ

### v2.5.1 (2026-02-03)
- Gitee/Gemini åŒæä¾›å•†ï¼ŒWebUI ç®¡ç†ç•Œé¢

### v1.x (2026-01)
- å¤šè½®æ³¨å…¥ã€One-Shot æ¶æ„ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†

---
*Generated with â¤ï¸ by ikirito*
